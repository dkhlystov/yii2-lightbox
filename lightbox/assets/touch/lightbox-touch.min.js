$(function(){function t(){var t=d.width(),i=d.height();u.each(function(){$(this).css({width:t,height:i})}),s.css({height:i,"margin-left":-t*s.data("touch"),width:u.length*t})}function i(t){var i=void 0!=t;i||(t=u);var n=d.width(),a=d.height(),e=n/a;t.each(function(){var t=$(this),o=t.find(".loading"),c=t.find(".buffer img"),h=t.find(".preview");if(0==o.css("opacity")||i){var r=c.width(),d=c.height(),f=r/d;f>e?(r=n,d=r/f):(d=a,r=d*f),h.css({height:d,"margin-left":-r/2,"margin-top":-d/2,width:r}).attr("src",c.attr("src")).animate({opacity:1},200),o.css("opacity",0)}})}function n(){u.each(function(){var t=$(this);t.find(".buffer img").attr("src",t.data("src"))})}function a(){i($(this).closest(".block"))}function e(){t(),i()}function o(t){var i=t.pageX;void 0==i&&(i=t.originalEvent.touches[0].pageX),$(":animated").stop(!0,!0),s.data({x:i,left:parseInt(s.css("margin-left"))}),d.bind("touchmove",h)}function c(t){d.unbind("touchmove",h);var i=d.width(),n=Math.round(-parseInt(s.data("left"))/i);-.05>v?n++:v>.05&&n--,n>u.length-1&&(n=u.length-1),0>n&&(n=0),s.data("touch",n).animate({"margin-left":-n*i},200),f.text(n+1)}function h(t){var i=t.pageX;void 0==i&&(i=t.originalEvent.touches[0].pageX);var n=i-s.data("x");if(s.css("margin-left",s.data("left")+n),null===l)l=Date.now(),g=i;else{var a=Date.now(),e=a-l,n=i-g;v=n/e,l=a,g=i}}function r(){$(".buffer img").bind("load",a),$(window).bind("orientationchange, resize",e),d.bind("touchstart",o),d.bind("touchend",c),t(),n()}var d=$("body"),f=$(".header span"),s=$(".container"),u=s.find(".block"),l=null,g=null,v=null;r()});